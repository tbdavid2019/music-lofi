# 更新日誌 (Changelog)

## 📝 已加入 README.md

所有新功能和音軌對照表已整合到 README.md 中：

- ✅ **音軌對照表**：在 "🎵 Ambient Track List" 章節
- ✅ **新功能說明**：在 "New Features 🎉" 章節
- ✅ **隨機背景功能**：詳細使用說明
- ✅ **直觀音軌名稱**：中英對照完整列表
- ✅ **手機版音軌顯示**：收合式音軌列表
- ✅ **Bing API 背景**：支援 Bing 每日高清桌布

---

## 2025-10-13 - 最新更新 (晚間更新)

### ✨ 新功能

#### 5. 🌐 Bing 每日高清桌布 API 整合 (新增！)

**功能描述**：整合 Bing 官方 API，提供每日更新的高解析度桌布，並自動偵測設備類型

**主要特色**：
- ✅ **一鍵切換 Bing 桌布**：點擊「Bing 每日桌布」按鈕即可載入
- ✅ **智能設備偵測**：自動識別手機或桌面設備
  - 📱 手機版: `bing.img.run/m.php` (優化手機顯示)
  - 💻 桌面版: `bing.img.run/1920x1080.php` (1920x1080 高解析度)
- ✅ **智能回退機制**：若 API 載入失敗，自動使用本地背景
- ✅ **狀態指示**：顯示載入中、成功或失敗狀態，並標示設備類型
- ✅ **快取功能**：成功載入的背景會儲存在 localStorage
- ✅ **雙軌制背景系統**：可隨時切換 Bing API 或本地背景

**使用方式**：
1. 按 `J` 鍵開啟設定面板
2. 前往 "Background" 區域
3. 點擊頂部的「🌐 Bing 每日桌布」按鈕
4. 系統會自動偵測設備並載入對應版本的 Bing 背景
5. 若成功，會顯示「✓ Bing 每日桌布」並標示設備類型（📱/💻）
6. 若失敗，自動回退到本地背景（bg1.jpg）

**技術實作**：
- API 端點:
  - 桌面版: `https://bing.img.run/1920x1080.php`
  - 手機版: `https://bing.img.run/m.php`
- 設備偵測邏輯:
  - 螢幕寬度 <= 600px
  - 或 User-Agent 包含移動設備標識
- Fetch timeout: 5 秒
- 回退邏輯: try-catch + HEAD request 檢查
- localStorage 鍵值:
  - `use-bing-api`: 儲存是否使用 Bing API (true/false)
  - `bing-bg-url`: 快取最後成功載入的 Bing URL
  - `bg-id`: 本地背景 ID (1-10)

**UI 設計**：
- 漸層按鈕: 藍綠色 (0,120,212) → (0,178,148)
- 啟用狀態: 發光效果 + 脈衝動畫
- 載入狀態: 顯示「載入中...」並禁用按鈕
- 提示文字: 「🌐 Bing 背景 (📱 手機版/💻 桌面版)」

**錯誤處理**：
- 網路超時 → 回退本地背景
- API 回應失敗 → 回退本地背景
- 圖片載入失敗 → 回退本地背景
- Console 記錄: 
  - 🔍 偵測設備類型
  - ✅ 成功訊息 (含版本)
  - ⚠️ 失敗訊息

---

## 2025-10-13 - 最新更新 (下午更新)

### ✨ 新功能

#### 4. 📱 手機版音軌列表優化 (新增！)

**問題**：原本手機版完全隱藏音軌列表，用戶無法在手機上切換環境音

**解決方案**：
- ✅ **可展開/收合介面**：底部顯示「顯示音軌」按鈕
- ✅ **播放數量顯示**：顯示當前播放音軌數（如：3/9）
- ✅ **不遮擋播放器**：收合時只佔用 50px 高度
- ✅ **優化觸控體驗**：更大的點擊區域，適合手機操作
- ✅ **平滑動畫**：展開/收合使用 0.3s 過渡動畫

**手機版使用方式**：
1. 點擊螢幕底部的「顯示音軌 (0/9)」按鈕
2. 音軌列表會從底部展開
3. 點擊任意音軌播放/暫停
4. 點擊「隱藏音軌」按鈕收起列表

**技術細節**：
- 固定在底部 20px（收合時）或 100px（展開時）
- 最大高度 65vh，支援滾動
- 背景毛玻璃效果 (backdrop-filter: blur(15px))
- 自適應卡片大小（手機版縮小圖片至 60x60px）

---

## 2025-10-13 - 最新更新 (上午更新)

### ✨ 新功能

#### 1. 🎨 背景圖片隨機載入
- **首次載入自動隨機**：當用戶第一次開啟應用時，會自動隨機選擇一張背景圖片
- **隨機按鈕**：在設定面板的背景區域新增「隨機背景」按鈕（🔄圖示）
- **一鍵換新**：點擊隨機按鈕可立即切換到隨機背景（確保不會選到當前背景）

**使用方式**：
- 開啟應用 → 按 `J` 或點擊 ⚙️ → Background → 點擊「隨機背景」按鈕

#### 2. 🎵 音軌標題更直觀
將原本的 "Track 1", "Track 2" 等改為更有意義的中文標題：

| 原標題 | 新標題 | 音效內容 |
|--------|--------|----------|
| Track 1 | 風聲 | 風聲環境音 |
| Track 2 | 海灘聲 | 海浪拍打沙灘 |
| Track 3 | 夜晚氛圍 | 夜晚環境音 |
| Track 4 | 海鷗聲 | 城市海鷗叫聲 |
| Track 5 | 辦公室 | 辦公室環境音 |
| Track 6 | 城市聲 | 城市環境噪音 |
| Track 7 | 伺服器 | 伺服器運作聲 |
| Track 8 | 火車聲 | 火車行駛聲 |
| Track 9 | 水下白噪音 | 水下白噪音 |

**效果**：用戶一看就知道是什麼音效，不用猜測！

#### 3. 🥁 小鼓預設靜音
- **預設音量改為 0%**：根據用戶反饋，小鼓聲預設改為靜音
- **其他鼓組預設值**：
  - Kick (大鼓): 70%
  - Snare (小鼓): **0%** ← 新增靜音
  - Hi-Hat (鈸): 50%
  - Piano (鋼琴): 100%

**清除舊設定**：如果想應用新的預設值，請：
1. 按 `J` 開啟設定
2. 滾動到「樂器控制」
3. 點擊「🔄 重置」按鈕

---

## 之前的更新

### 📦 預設管理系統
- 保存/載入音樂配置
- 匯出/匯入 JSON 檔案
- 重置為預設值功能

### 🎙️ 錄音功能
- 支援 1/5/10/30/60 分鐘錄音
- WebM 格式下載
- 完整混音錄製

### ⏰ 定時器系統
- 番茄鐘模式 (25分工作 + 5分休息)
- 睡眠定時器 (自動淡出)
- 自訂計時器 (1-240分鐘)

### 🎛️ 樂器音量控制
- 獨立控制鋼琴、Kick、Snare、Hi-Hat 音量
- 快速預設：純鋼琴、輕鼓點、重置
- 個別靜音按鈕

### 🔗 專案更新
- 更新 GitHub 連結至 `tbdavid2019/music-lofi`
- 致謝原作者 `meel-hd/lofi-engine`
- 合併所有 MD 文件到 README.md

---

## 技術細節

### 檔案修改清單

1. **src/lib/components/TrackList/index.svelte**
   - 新增 `title` 屬性到每個音軌
   - 更新音軌資料結構

2. **src/lib/components/TrackList/TrackListItem.svelte**
   - 更新顯示邏輯使用 `track.title`
   - 保留 fallback 顯示 `Track ${track.id}`

3. **src/lib/components/Controls/Settings/Background.svelte**
   - 新增 `randomBg()` 函數
   - 首次載入時隨機選擇背景
   - 新增隨機按鈕 UI
   - 導入 `IconRefresh` 圖示

4. **src/lib/PlayButton.svelte**
   - 修改預設樂器音量：`snare: 0` (原為 `0.6`)

5. **src/lib/components/InfoBox/SocialLinks.svelte**
   - 更新 GitHub 連結

6. **README.md**
   - 合併 NEW_FEATURES.md 和 IMPLEMENTATION_SUMMARY.md
   - 更新安裝說明
   - 新增致謝區塊
   - 標註小鼓預設靜音

---

## 如何使用新功能

### 🎨 隨機背景
```
方法1: 首次開啟應用會自動隨機
方法2: 按 J → Background → 點擊「隨機背景」按鈕
```

### 🎵 查看新的音軌標題
```
左側音軌列表會直接顯示「海灘聲」、「風聲」等中文標題
不再是 Track 1, Track 2 了！
```

### 🥁 調整小鼓音量
```
按 J → 樂器控制 → 調整 Snare 滑桿
預設已經是 0%（靜音）
```

---

## 已知問題

無

---

## 下一步計劃

- [ ] 更多音軌選擇
- [ ] 自訂音軌上傳功能
- [ ] 更多背景圖片
- [ ] 主題切換功能
